# Chapter 2

## 为什么重构是必要的？

<aside>
😭 代码在诞生的时候是由一个个单一的功能组合起来的，这种组合就形成了代码结构。后期不断新增功能，如果只是简单的堆叠组合，代码将越来越庞杂，越难插入新功能，越难维护老功能。
</aside>

对 **重构** 这个词进行定义，可以分为**调整代码结构**这个动作（动词），和进行这个动作的**重构手法**（名词）。

一个产品，全部需求的功能集合必然不会是零散的而是**有组织**的。但**代码是从零散**的功能**开始**编写，**最终组合**成**有结构**的**程序设计**。

从产品维度上来说，重构做的事情就是把**每一步做的零散的功能重整为有机的整体**，还原最终的设计意图。从代码维度上说，重构是要**整理代码结构**到人类可以尽量的**一眼就能看懂产品设计**地步。

---

*重构的原则：*

1. 营地法则：代码结构要比刚开始做的时候好一点点，整洁一点点
2. 小步修改，保持程序随时可用
3. 先让修改变得容易（最困难的地方），再做容易的修改

---

*为什么不一开始就做好设计模式？*

因为需求是不断变化和新增的。需求的变化和新增带来新代码（可能）破坏原有的代码结构，需要重构来恢复更好加入新功能的代码结构。

---

*为什么已经完成的功能仍然需要重构？*

程序员的能力和认知水平同样也是不断提升的。程序员的能力和认知水平的提升（可能）会带来更好的业务与程序设计，达到更好的代码结构。

---

*什么时候应该开始重构？*

从零开始写的代码，应该实时重构，一来可以帮助厘清功能逻辑，有助于达到更好的实现；二来可以清晰代码结构，及时发现 bug。

接手旧代码库，开发某一模块的时候对特定模块进行重构，以方便自己加入新功能，同时遵守了营地法则。

---

*这世界上没有银弹，重构必然有其无法达到的目标？*

1. 大型团队（功能）间的合作

   重构只能在自己能写的代码中进行，大型团队（功能）间合作，以 API 调用的形式协作，很容易将调用方正在使用的 API 改动。

   基于此，可以使用并行代码，将实现重构，调用处提示“将废弃 `deprecation` ”。

2. 重构与新增功能的取舍

   一般来说重构都在新增功能前进行，以期新增功能可以毫不费力的加入。但若旧有代码的重构将耗费巨大，新增功能时间紧急，可以先新增功能，后一起重构。

3. 对代码屎山的重构

   在程序接缝处加入测试，由接缝处入手开始重构。这种时候需要更多的时间，更细致更小步的重构来达成目标。（按理说不应该出现耗时上月的重构）

---

*现代编程工具和编程实践如何用好重构？*

IDE 的自动化重构工具。

持续集成，功能性单元测试，重构。（后两者构成了 TDD）

---

- *推荐书目*

  《重构手册》Bill Wake

  《重构与模式》Josh Kerievsky

  《重构HTML》Elliotte Rusty Harold/《数据库重构》Scott Ambler, Pramod Sadalage

  《修改代码的艺术》Michael Feathers

  《重构 Ruby 版》Jay Fields, Shane Harvey